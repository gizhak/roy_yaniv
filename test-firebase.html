<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ Firebase Test - ×‘×“×™×§×ª Firebase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .success {
            color: #00ff00;
        }

        .error {
            color: #ff4444;
        }

        .warning {
            color: #ffaa00;
        }

        .info {
            color: #00aaff;
        }

        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .status.waiting {
            background: #ffc107;
            color: #333;
        }

        .status.success {
            background: #4caf50;
            color: white;
        }

        .status.error {
            background: #f44336;
            color: white;
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .clear-btn {
            background: #dc3545;
        }

        .step {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
        }

        .step.active {
            border-color: #667eea;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”¥ Firebase Test</h1>
        <p class="subtitle">×‘×“×™×§×ª ×—×™×‘×•×¨ ×œ-Firebase Firestore</p>

        <div id="connectionStatus" class="status waiting">â³ ×××ª×™×Ÿ ×œ×‘×“×™×§×”...</div>

        <!-- Step 1: Setup Check -->
        <div class="test-section">
            <h2><span class="step-number">1</span> ×‘×“×™×§×ª ×”×’×“×¨×•×ª</h2>
            <div class="buttons">
                <button onclick="checkFirebaseConfig()">×‘×“×•×§ Firebase Config</button>
                <button onclick="testConnection()">×‘×“×•×§ ×—×™×‘×•×¨</button>
            </div>
            <div id="setupOutput" class="output" style="display: none;"></div>
        </div>

        <!-- Step 2: Data Initialization -->
        <div class="test-section">
            <h2><span class="step-number">2</span> ××ª×—×•×œ × ×ª×•× ×™×</h2>
            <div class="buttons">
                <button onclick="initializeData()">×˜×¢×Ÿ × ×ª×•× ×™× ×-data.json</button>
                <button onclick="checkCollections()">×‘×“×•×§ Collections</button>
            </div>
            <div id="initOutput" class="output" style="display: none;"></div>
        </div>

        <!-- Step 3: CRUD Operations -->
        <div class="test-section">
            <h2><span class="step-number">3</span> ×‘×“×™×§×ª ×¤×¢×•×œ×•×ª CRUD</h2>
            <div class="buttons">
                <button onclick="testRead()">×§×¨× (Read)</button>
                <button onclick="testCreate()">×¦×•×¨ (Create)</button>
                <button onclick="testUpdate()">×¢×“×›×Ÿ (Update)</button>
                <button onclick="testDelete()">××—×§ (Delete)</button>
            </div>
            <div id="crudOutput" class="output" style="display: none;"></div>
        </div>

        <!-- Step 4: Integration Test -->
        <div class="test-section">
            <h2><span class="step-number">4</span> ×‘×“×™×§×” ××œ××”</h2>
            <div class="buttons">
                <button onclick="runFullTest()">ğŸš€ ×”×¨×¥ ×‘×“×™×§×” ××œ××”</button>
                <button class="clear-btn" onclick="clearAll()">ğŸ—‘ï¸ × ×§×” ×”×›×œ</button>
            </div>
            <div id="fullTestOutput" class="output" style="display: none;"></div>
        </div>
    </div>

    <script type="module">
        import { firebaseService } from './js/services/firebase.service.js';

        // Make functions available globally
        window.firebaseService = firebaseService;

        window.log = (outputId, message, type = 'info') => {
            const output = document.getElementById(outputId);
            output.style.display = 'block';
            const timestamp = new Date().toLocaleTimeString('he-IL');
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            output.innerHTML += `<span class="${type}">[${timestamp}] ${icon} ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        };

        window.clearOutput = (outputId) => {
            const output = document.getElementById(outputId);
            output.innerHTML = '';
            output.style.display = 'none';
        };

        window.setStatus = (status, type) => {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.textContent = status;
            statusEl.className = `status ${type}`;
        };

        // Test Functions
        window.checkFirebaseConfig = async () => {
            clearOutput('setupOutput');
            log('setupOutput', '×‘×•×“×§ ×”×’×“×¨×•×ª Firebase...', 'info');

            try {
                const config = firebaseService.COLLECTIONS;
                log('setupOutput', `Collections: ${JSON.stringify(config, null, 2)}`, 'success');
                log('setupOutput', '×”×”×’×“×¨×•×ª × ×¨××•×ª ×ª×§×™× ×•×ª!', 'success');
            } catch (error) {
                log('setupOutput', `×©×’×™××”: ${error.message}`, 'error');
            }
        };

        window.testConnection = async () => {
            clearOutput('setupOutput');
            log('setupOutput', '××ª×—×‘×¨ ×œ-Firebase...', 'info');

            try {
                const userData = await firebaseService.getUserData();
                if (userData) {
                    log('setupOutput', '×”×—×™×‘×•×¨ ×”×¦×œ×™×—! âœ¨', 'success');
                    log('setupOutput', `× ××¦××• × ×ª×•× ×™×: ${JSON.stringify(userData, null, 2)}`, 'success');
                    setStatus('âœ… ××—×•×‘×¨ ×œ-Firebase', 'success');
                } else {
                    log('setupOutput', '×”×—×™×‘×•×¨ ×”×¦×œ×™×— ××‘×œ ××™×Ÿ × ×ª×•× ×™×', 'warning');
                    log('setupOutput', '×”×¨×¥ "×˜×¢×Ÿ × ×ª×•× ×™× ×-data.json"', 'warning');
                    setStatus('âš ï¸ ××—×•×‘×¨ ××‘×œ ××™×Ÿ × ×ª×•× ×™×', 'warning');
                }
            } catch (error) {
                log('setupOutput', `×©×’×™××ª ×—×™×‘×•×¨: ${error.message}`, 'error');
                log('setupOutput', '×‘×“×•×§ ××ª firebase-config.js ×•××ª Security Rules', 'error');
                setStatus('âŒ ×›×™×©×œ×•×Ÿ ×‘×—×™×‘×•×¨', 'error');
            }
        };

        window.initializeData = async () => {
            clearOutput('initOutput');
            log('initOutput', '×˜×•×¢×Ÿ ××ª data.json...', 'info');

            try {
                const response = await fetch('data.json');
                const data = await response.json();
                log('initOutput', 'data.json × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”', 'success');

                log('initOutput', '×©×•××¨ ×œ-Firebase...', 'info');
                await firebaseService.initFromJSON(data);

                log('initOutput', 'âœ¨ ×”× ×ª×•× ×™× × ×˜×¢× ×• ×œ-Firebase ×‘×”×¦×œ×—×”!', 'success');
                log('initOutput', `- User Data: ${data.user.name}`, 'info');
                log('initOutput', `- Products: ${data.products.length} ×¤×¨×™×˜×™×`, 'info');
                log('initOutput', `- Testimonials: ${data.testimonials.length} ×”××œ×¦×•×ª`, 'info');
                setStatus('âœ… ×”× ×ª×•× ×™× × ×˜×¢× ×•', 'success');
            } catch (error) {
                log('initOutput', `×©×’×™××”: ${error.message}`, 'error');
                setStatus('âŒ ×©×’×™××” ×‘××ª×—×•×œ', 'error');
            }
        };

        window.checkCollections = async () => {
            clearOutput('initOutput');
            log('initOutput', '×‘×•×“×§ Collections...', 'info');

            try {
                const user = await firebaseService.getUserData();
                const products = await firebaseService.getProducts();
                const testimonials = await firebaseService.getTestimonials();

                log('initOutput', 'ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª:', 'info');
                log('initOutput', `- User Data: ${user ? 'âœ… ×§×™×™×' : 'âŒ ×—×¡×¨'}`, user ? 'success' : 'error');
                log('initOutput', `- Products: ${products.length} ×¤×¨×™×˜×™×`, products.length > 0 ? 'success' : 'warning');
                log('initOutput', `- Testimonials: ${testimonials.length} ×”××œ×¦×•×ª`, testimonials.length > 0 ? 'success' : 'warning');

                if (products.length > 0) {
                    log('initOutput', `\n××•×¦×¨ ×œ×“×•×’××”: ${products[0].title}`, 'info');
                }
            } catch (error) {
                log('initOutput', `×©×’×™××”: ${error.message}`, 'error');
            }
        };

        window.testRead = async () => {
            clearOutput('crudOutput');
            log('crudOutput', '×‘×•×“×§ ×§×¨×™××” (Read)...', 'info');

            try {
                const products = await firebaseService.getProducts();
                log('crudOutput', `âœ… × ×§×¨××• ${products.length} ××•×¦×¨×™×`, 'success');

                if (products.length > 0) {
                    log('crudOutput', `×“×•×’××”: ${JSON.stringify(products[0], null, 2)}`, 'info');
                }
            } catch (error) {
                log('crudOutput', `âŒ ×©×’×™××”: ${error.message}`, 'error');
            }
        };

        window.testCreate = async () => {
            clearOutput('crudOutput');
            log('crudOutput', '×‘×•×“×§ ×™×¦×™×¨×” (Create)...', 'info');

            try {
                const testProduct = {
                    title: '×§×•×¨×¡ ×‘×“×™×§×”',
                    description: '×–×”×• ×§×•×¨×¡ ×œ×‘×“×™×§×” ×‘×œ×‘×“',
                    price: 99,
                    image: 'https://via.placeholder.com/400x300'
                };

                const created = await firebaseService.addProduct(testProduct);
                log('crudOutput', `âœ… × ×•×¦×¨ ××•×¦×¨ ×—×“×©: ${created.id}`, 'success');
                log('crudOutput', JSON.stringify(created, null, 2), 'info');

                // Save ID for other tests
                window.testProductId = created.id;
            } catch (error) {
                log('crudOutput', `âŒ ×©×’×™××”: ${error.message}`, 'error');
            }
        };

        window.testUpdate = async () => {
            clearOutput('crudOutput');
            log('crudOutput', '×‘×•×“×§ ×¢×“×›×•×Ÿ (Update)...', 'info');

            try {
                if (!window.testProductId) {
                    log('crudOutput', 'âš ï¸ ×§×•×“× ×¦×•×¨ ××•×¦×¨ ×—×“×©', 'warning');
                    return;
                }

                const updated = await firebaseService.updateProduct({
                    id: window.testProductId,
                    title: '×§×•×¨×¡ ×‘×“×™×§×” - ××¢×•×“×›×Ÿ!',
                    description: '×”×ª×™××•×¨ ×¢×•×“×›×Ÿ',
                    price: 149,
                    image: 'https://via.placeholder.com/400x300'
                });

                log('crudOutput', `âœ… ×”××•×¦×¨ ×¢×•×“×›×Ÿ: ${updated.id}`, 'success');
                log('crudOutput', JSON.stringify(updated, null, 2), 'info');
            } catch (error) {
                log('crudOutput', `âŒ ×©×’×™××”: ${error.message}`, 'error');
            }
        };

        window.testDelete = async () => {
            clearOutput('crudOutput');
            log('crudOutput', '×‘×•×“×§ ××—×™×§×” (Delete)...', 'info');

            try {
                if (!window.testProductId) {
                    log('crudOutput', 'âš ï¸ ×§×•×“× ×¦×•×¨ ××•×¦×¨ ×—×“×©', 'warning');
                    return;
                }

                await firebaseService.removeProduct(window.testProductId);
                log('crudOutput', `âœ… ×”××•×¦×¨ × ××—×§: ${window.testProductId}`, 'success');
                window.testProductId = null;
            } catch (error) {
                log('crudOutput', `âŒ ×©×’×™××”: ${error.message}`, 'error');
            }
        };

        window.runFullTest = async () => {
            clearOutput('fullTestOutput');
            log('fullTestOutput', 'ğŸš€ ××ª×—×™×œ ×‘×“×™×§×” ××œ××”...', 'info');
            log('fullTestOutput', 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');

            try {
                // Test 1: Connection
                log('fullTestOutput', '\n1ï¸âƒ£ ×‘×•×“×§ ×—×™×‘×•×¨...', 'info');
                const user = await firebaseService.getUserData();
                log('fullTestOutput', user ? '   âœ… ×—×™×‘×•×¨ ×ª×§×™×Ÿ' : '   âš ï¸ ××™×Ÿ × ×ª×•× ×™×', user ? 'success' : 'warning');

                // Test 2: Read All
                log('fullTestOutput', '\n2ï¸âƒ£ ×§×•×¨× × ×ª×•× ×™×...', 'info');
                const products = await firebaseService.getProducts();
                const testimonials = await firebaseService.getTestimonials();
                log('fullTestOutput', `   âœ… ${products.length} ××•×¦×¨×™×`, 'success');
                log('fullTestOutput', `   âœ… ${testimonials.length} ×”××œ×¦×•×ª`, 'success');

                // Test 3: Create
                log('fullTestOutput', '\n3ï¸âƒ£ ×™×•×¦×¨ ××•×¦×¨ ×‘×“×™×§×”...', 'info');
                const newProduct = await firebaseService.addProduct({
                    title: 'Full Test Product',
                    description: 'Created by full test',
                    price: 199,
                    image: 'https://via.placeholder.com/400x300'
                });
                log('fullTestOutput', `   âœ… × ×•×¦×¨: ${newProduct.id}`, 'success');

                // Test 4: Update
                log('fullTestOutput', '\n4ï¸âƒ£ ××¢×“×›×Ÿ...', 'info');
                await firebaseService.updateProduct({
                    ...newProduct,
                    title: 'Full Test Product - Updated'
                });
                log('fullTestOutput', '   âœ… ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”', 'success');

                // Test 5: Delete
                log('fullTestOutput', '\n5ï¸âƒ£ ××•×—×§...', 'info');
                await firebaseService.removeProduct(newProduct.id);
                log('fullTestOutput', '   âœ… × ××—×§ ×‘×”×¦×œ×—×”', 'success');

                log('fullTestOutput', '\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log('fullTestOutput', 'ğŸ‰ ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”!', 'success');
                setStatus('âœ… ×”×›×œ ×¢×•×‘×“ ××¦×•×™×Ÿ!', 'success');

            } catch (error) {
                log('fullTestOutput', '\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'error');
                log('fullTestOutput', `âŒ ×”×‘×“×™×§×” × ×›×©×œ×”: ${error.message}`, 'error');
                setStatus('âŒ ×™×© ×‘×¢×™×”', 'error');
            }
        };

        window.clearAll = () => {
            ['setupOutput', 'initOutput', 'crudOutput', 'fullTestOutput'].forEach(id => {
                clearOutput(id);
            });
            setStatus('â³ ×××ª×™×Ÿ ×œ×‘×“×™×§×”...', 'waiting');
        };

        // Auto-check on load
        setTimeout(() => {
            testConnection();
        }, 500);
    </script>
</body>

</html>